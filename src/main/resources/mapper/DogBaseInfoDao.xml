<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chxd.policeDog.dao.IDogBaseInfoDao">


	<sql id="condition">
		<if test="dogInfo.id != null" > and id=#{dogInfo.id}</if>
		<if test="dogInfo.chipNo != null" > and chip_no=#{dogInfo.chipNo}</if>

		<if test="dogInfo.birthdayStart != null" ><![CDATA[  and birthday>=#{dogInfo.birthdayStart} ]]></if>
		<if test="dogInfo.birthdayEnd != null" ><![CDATA[  and birthday<=#{dogInfo.birthdayEnd} ]]></if>

		<if test="dogInfo.growthStage != null" > and growth_stage=#{dogInfo.growthStage}</if>
		<if test="dogInfo.nestNo != null" > and nest_no=#{dogInfo.nestNo}</if>
		<if test="dogInfo.fatherId != null" > and chip_no=#{dogInfo.fatherId}</if>
		<if test="dogInfo.motherId != null" > and chip_no=#{dogInfo.motherId}</if>
		<if test="dogInfo.sex != null" > and sex=#{dogInfo.sex}</if>
		<if test="dogInfo.breed != null" > and breed=#{dogInfo.breed}</if>
		<if test="dogInfo.dogSource != null" > and dog_source=#{dogInfo.dogSource}</if>
		<if test="dogInfo.dogColour != null" > and dog_colour=#{dogInfo.dogColour}</if>
		<if test="dogInfo.hairType != null" > and hair_type=#{dogInfo.hairType}</if>
		<if test="dogInfo.dogType != null" > and dog_type=#{dogInfo.dogType}</if>
		<if test="dogInfo.dogSource != null" > and dog_source=#{dogInfo.dogSource}</if>
		<if test="dogInfo.dogLevel != null" > and dog_level=#{dogInfo.dogLevel}</if>
		<if test="dogInfo.fileNo != null" > and file_no=#{dogInfo.fileNo}</if>
		<if test="dogInfo.tutor != null" > and tutor=#{dogInfo.tutor}</if>
		<if test="dogInfo.policeId != null" > and police_id=#{dogInfo.policeId}</if>
		<if test="dogInfo.policeName != null" > and police_name=#{dogInfo.policeName}</if>
	</sql>

	<sql id="pageCondition">
		limit #{page.startRow}, #{page.pageSize}
	</sql>

	<select id="selectAll" resultType="com.chxd.policeDog.vo.DogBaseInfoVO">
		select * from t_dog_base where 1=1
		<include refid="condition"/>
		<include refid="pageCondition"/>
	</select>

	<select id="selectAllCount" resultType="java.lang.Integer">
		select count(1) from t_dog_base where 1=1
		<include refid="condition"/>
	</select>

	<insert id="add" parameterType="java.util.List">
		insert into t_dog_base (dog_name, chip_no, chip_no_inject, sex, birthday,
								breed, dog_source, dog_colour, hair_type, dog_type, dog_level,
								inbreeding, tutor, breeder, train_score, next_train_date, work_place,
								work_area, work_province, file_no, create_doc_date, dog_photo, nest_no,
								father_id, mother_id, growth_stage, work_stage, belonging, creation_date, last_update_date)
		values
		<foreach collection="list" item="item" index="index" separator="," >
			(
			  #{item.dogName}, #{item.chipNo}, #{item.chipNoInjectStr}, #{item.sex}, #{item.birthdayStr},
			  #{item.breed}, #{item.dogSource}, #{item.dogColour}, #{item.hairType}, #{item.dogType}, #{item.dogLevel},
			  #{item.inbreeding}, #{item.tutor}, #{item.breeder}, #{item.trainScore}, #{item.nextTrainDate}, #{item.workPlace},
			  #{item.workArea}, #{item.workProvince}, #{item.fileNo}, #{item.createDocDate}, #{item.dogPhoto}, #{item.nestNo},
			  #{item.fatherId}, #{item.motherId}, #{item.growthStage}, #{item.workStage}, #{item.belonging}, #{item.creationDate}, #{item.lastUpdateDate}
			)
		</foreach>
	</insert>

	<insert id="addWorm" parameterType="java.util.List">
		insert into t_dog_worm (dog_id, nest_no, worm_date, worm_state, police_id, worm_desc, police_name)
		values
		<foreach collection="list" item="item" index="index" separator="," >
			(
			#{item.dogId}, #{item.nestNo}, #{item.wormDate}, #{item.wormState}, #{item.policeId}, #{item.wormDesc}, #{item.policeName}
			)
		</foreach>
	</insert>

	<insert id="addImmue" parameterType="java.util.List">
		insert into t_dog_immue (dog_id, nest_no, immue_date, immue_name, immue_state, police_id, police_name)
		values
		<foreach collection="list" item="item" index="index" separator="," >
			(
			#{item.dogId}, #{item.nestNo}, #{item.immueDate}, #{item.immueName}, #{item.immueState}, #{item.policeId}, #{item.policeName}
			)
		</foreach>
	</insert>

	<update id="tickOut">
		update t_dog_base set work_stage=3,belonging=#{belong} where id in
		<foreach collection="list" item="item" index="index" separator="," open="(" close=")">
			#{item.id}
		</foreach>
	</update>

	<update id="died">
		update t_dog_base set work_stage=4 where id in
		<foreach collection="list" item="item" index="index" separator="," open="(" close=")">
			#{item.id}
		</foreach>
	</update>

	<select id="search" resultType="com.chxd.policeDog.vo.DogBaseInfoVO">
		select * from t_dog_base where chip_no like concat(#{chipNo} '%') limit 0, 20
	</select>

</mapper>